<!doctype html>
<html lang="{{ lang }}">
<head>
    <meta charset="utf-8">
    <title>{{ ui.page_title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>
<div class="page">
    <header class="card">
        <div class="header-row">
            <h1>{{ ui.header_title }}</h1>
            <form class="language-switcher" method="get">
{#                <label for="language-select">{{ ui.language_label }}</label>#}
                <div class="language-switcher-controls">
                    <select id="language-select" name="lang" onchange="this.form.submit()">
                        {% for entry in languages %}
                            <option value="{{ entry.code }}"
                                    {% if entry.code == lang %}selected{% endif %}>{{ entry.label }}</option>
                        {% endfor %}
                    </select>
                    <noscript>
                        <button type="submit" class="btn-secondary">{{ ui.language_submit }}</button>
                    </noscript>
                </div>
                <input type="hidden" name="style" value="{{ style }}">
            </form>
        </div>
        <p>{{ ui.header_description }}</p>
    </header>

    <form class="card form-card" data-solver-form>
        <input type="hidden" name="lang" value="{{ lang }}">
        <section>
            <h3 class="section-title">{{ ui.section_base }}</h3>
            <div class="grid-two">
                <label>
                    <span class="label">{{ ui.field_style }}</span>
                    <select name="style">
                        {% for s in styles %}
                            <option value="{{ s.id }}" {% if s.id == style %}selected{% endif %}>{{ s.name }}</option>
                        {% endfor %}
                    </select>
                </label>
            <p>{{ ui.instructions }}</p>
            </div>
            <input type="hidden" name="total_cap" value="{{ total_cap }}">
            <input type="hidden" name="per_cap" value="{{ per_cap }}">
        </section>

        <section class="attributes-section">
            <div class="attributes-layout">
                <div class="attributes-column">
                    <div class="column-header">
                        <h3 class="section-title">{{ ui.section_attributes }}</h3>
                        <button type="button" class="btn-make-green" data-set-all-green
                                data-label-green="{{ ui.button_all_green }}"
                                data-label-any="{{ ui.button_all_any }}">
                            <span data-set-all-green-label>{{ ui.button_all_green }}</span>
                        </button>
                    </div>
                    <div class="attr-list">
                    {% for a in attrs %}
                        {% set constraint = constraints[a] %}
                        {% set slider_value_str = constraint.value if constraint.value else '5.5' %}
                        {% set slider_value = slider_value_str|float %}
                        {% set slider_step = '%.0f'|format(slider_value * 10) %}
                        <div class="attr-card" data-attr-card data-attr="{{ a }}">
                            <div class="attr-card-header">
                                <h4>{{ attr_labels[a] }}</h4>
                                <button type="button" class="chip chip-clear" data-clear-color title="{{ ui.button_clear_color }}">
                                    <span>{{ ui.button_clear_color }}</span>
                                </button>
                            </div>
                            <div class="attr-card-body">
                                <div class="chips chips-colors" data-color-group>
                                    {% for band in ['green', 'yellow', 'red'] %}
                                        {% set label = band_labels.get(band, band) %}
                                        <label class="chip" data-color="{{ band }}">
                                            <input type="radio" name="band_{{ a }}" value="{{ band }}"
                                                   data-color-radio
                                                   {% if constraints[a].band == band %}checked{% endif %}>
                                            <span>{{ label }}</span>
                                        </label>
                                    {% endfor %}
                                </div>
                                <div class="attr-controls" data-slider-area data-mode="{{ constraint.mode }}">
                                    <div class="slider-row">
                                        <div class="slider-range" data-slider-wrapper>
                                            <input type="range" min="0" max="110" step="1" value="{{ slider_step }}"
                                                   data-slider-role="min" data-initial-value="{{ '%.1f'|format(slider_value) }}"
                                                   aria-valuemin="0" aria-valuemax="11" aria-valuenow="{{ '%.1f'|format(slider_value) }}"
                                                   aria-label="{{ attr_labels[a] }}">
                                            <input type="range" min="0" max="110" step="1" value="{{ slider_step }}"
                                                   data-slider-role="max" data-initial-value="{{ '%.1f'|format(slider_value) }}"
                                                   aria-valuemin="0" aria-valuemax="11" aria-valuenow="{{ '%.1f'|format(slider_value) }}"
                                                   aria-label="{{ attr_labels[a] }}">
                                        </div>
                                        <button type="button" class="icon-btn" data-copy-attr
                                                aria-label="{{ ui.button_copy_attr }}" title="{{ ui.button_copy_attr }}">
                                            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                                <path d="M8 3h9a2 2 0 0 1 2 2v11h-2V5H8z" />
                                                <path d="M5 8h9a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2zm0 2v9h9v-9z" />
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="slider-meta">
                                        <div class="mode-toggle" role="group" aria-label="{{ ui.label_mode }}">
                                            <button type="button" class="mode-btn" data-mode-btn data-mode="eq"
                                                    aria-label="{{ mode_labels.get('eq', '=') }}"
                                                    title="{{ mode_labels.get('eq', '=') }}"
                                                    aria-pressed="{{ 'true' if constraints[a].mode == 'eq' else 'false' }}">=</button>
                                            <button type="button" class="mode-btn" data-mode-btn data-mode="ge"
                                                    aria-label="{{ mode_labels.get('ge', 'â‰¥') }}"
                                                    title="{{ mode_labels.get('ge', 'â‰¥') }}"
                                                    aria-pressed="{{ 'true' if constraints[a].mode in ['ge', 'between'] else 'false' }}">â‰¥</button>
                                            <button type="button" class="mode-btn" data-mode-btn data-mode="le"
                                                    aria-label="{{ mode_labels.get('le', 'â‰¤') }}"
                                                    title="{{ mode_labels.get('le', 'â‰¤') }}"
                                                    aria-pressed="{{ 'true' if constraints[a].mode in ['le', 'between'] else 'false' }}">â‰¤</button>
                                        </div>
                                        <div class="slider-value" data-slider-display>
                                            <div class="slider-value-single" data-slider-single>
                                                <span class="slider-value-label">{{ ui.label_value_display }}</span>
                                                <span class="slider-value-number" data-slider-single-value>{{ '%.1f'|format(slider_value) }}</span>
                                            </div>
                                            <div class="slider-value-range" data-slider-range hidden>
                                                <div class="slider-range-value">
                                                    <span class="slider-value-label">{{ ui.label_lower_limit }}</span>
                                                    <span class="slider-value-number" data-slider-min-value>{{ constraint.min if constraint.min else '%.1f'|format(slider_value) }}</span>
                                                </div>
                                                <div class="slider-range-value">
                                                    <span class="slider-value-label">{{ ui.label_upper_limit }}</span>
                                                    <span class="slider-value-number" data-slider-max-value>{{ constraint.max if constraint.max else '%.1f'|format(slider_value) }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" name="mode_{{ a }}" value="{{ constraint.mode }}" data-mode-input>
                            <input type="hidden" name="min_{{ a }}" value="{{ constraint.min }}" data-min-input>
                            <input type="hidden" name="max_{{ a }}" value="{{ constraint.max }}" data-max-input>
                        </div>
                    {% endfor %}
                    </div>
                </div>
                <aside class="ingredients-column">
                    <div class="column-header ingredients-header">
                        <h3 class="section-title">{{ ui.section_ingredients }}</h3>
                        <button type="button" class="btn-secondary optional-toggle"
                                data-toggle-optional
                                data-label-select="{{ ui.button_optional_all }}"
                                data-label-clear="{{ ui.button_optional_none }}">
                            <span data-toggle-optional-label>{{ ui.button_optional_all }}</span>
                        </button>
                    </div>
                    <div class="mobile-attr-toggle" data-attribute-toggle hidden>
                        <label>
                            <input type="checkbox" data-attribute-toggle-input>
                            <span>{{ ui.toggle_show_attributes }}</span>
                        </label>
                    </div>
                    <div class="table-wrapper" data-ingredients-wrapper data-hide-attributes="false">
                        <table class="ingredients-table ingredients-table--compact">
                            <thead>
                            <tr>
                                <th class="col-checkbox">{{ ui.table_include }}</th>
                                <th class="col-optional">{{ ui.table_optional }}</th>
                                <th>{{ ui.table_name }}</th>
                                <th>{{ ui.table_taste }}</th>
                                <th>{{ ui.table_color }}</th>
                                <th>{{ ui.table_strength }}</th>
                                <th>{{ ui.table_foam }}</th>
                                <th>{{ ui.table_cost }}</th>
                            </tr>
                            </thead>
                            {% for category in ingredient_categories %}
                                <tbody data-category-header data-category-id="{{ category.id }}">
                                    <tr class="ingredient-category-header">
                                        <td colspan="7">
                                            <button type="button" class="category-toggle" data-category-toggle
                                                    data-category-id="{{ category.id }}" aria-expanded="true">
                                                <span class="category-toggle-icon" aria-hidden="true"></span>
                                                <span class="category-toggle-label">{{ category.name }}</span>
                                                <span class="category-toggle-count">({{ category.ingredients | length }})</span>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                                <tbody class="ingredient-category-body" data-ingredient-category
                                       data-category-id="{{ category.id }}">
                                    {% for ing in category.ingredients %}
                                        {% set required_count = style_mins.get(ing.id, 0) %}
                                        {% set is_required = required_count > 0 %}
                                        {% set is_locked = is_required %}
                                        {% set is_checked = is_locked or ing.id in selected_required %}
                                        {% set is_optional = ing.id in selected_optional %}
                                        <tr class="{% if is_locked %}ingredient-locked{% endif %}" data-ingredient-row
                                            data-ingredient-id="{{ ing.id }}">
                                            <td class="checkbox-cell">
                                                <label class="ingredient-option"
                                                       {% if is_locked %}title="{{ ui.tooltip_required }}"{% endif %}>
                                                    <input type="checkbox" name="selected_ingredients" value="{{ ing.id }}"
                                                           aria-label="{{ ui.label_include }}"
                                                           {% if is_checked %}checked{% endif %}
                                                           {% if is_locked %}disabled{% endif %}
                                                           data-user-selected="{{ 'true' if ing.id in selected_required else 'false' }}">
                                                    <span class="checkbox-visual"></span>
                                                    <span class="sr-only">{{ ui.label_include }}</span>
                                                </label>
                                            </td>
                                            <td class="optional-cell">
                                                <label class="ingredient-optional">
                                                    <input type="checkbox" name="optional_ingredients" value="{{ ing.id }}"
                                                           aria-label="{{ ui.label_optional }}"
                                                           {% if is_optional %}checked{% endif %}
                                                           {% if is_locked %}disabled{% endif %}
                                                           data-user-optional="{{ 'true' if is_optional else 'false' }}">
                                                    <span class="checkbox-visual"></span>
                                                    <span class="sr-only">{{ ui.label_optional }}</span>
                                                </label>
                                            </td>
                                            <td class="ingredient-name-cell" data-label="{{ ui.table_name }}">
                                                <div class="ingredient-name">
                                                    <span>{{ ing.name }}</span>
                                                    <span class="ingredient-badge badge-required" data-required-badge
                                                          {% if not is_required %}hidden{% endif %}>
                          {% if is_required %}
                              {% if required_count > 1 %}
                                  {{ ui.badge_required_multiple | replace('{count}', '%d' % required_count) }}
                              {% else %}
                                  {{ ui.badge_required_single }}
                              {% endif %}
                          {% else %}
                              {{ ui.badge_required_single }}
                          {% endif %}
                        </span>
                                                </div>
                                            </td>
                                            <td data-label="{{ ui.table_taste }}" data-attr-cell>{{ '%.1f'|format(ing.vec[0]) }}</td>
                                            <td data-label="{{ ui.table_color }}" data-attr-cell>{{ '%.1f'|format(ing.vec[1]) }}</td>
                                            <td data-label="{{ ui.table_strength }}" data-attr-cell>{{ '%.1f'|format(ing.vec[2]) }}</td>
                                            <td data-label="{{ ui.table_foam }}" data-attr-cell>{{ '%.1f'|format(ing.vec[3]) }}</td>
                                            <td data-label="{{ ui.table_cost }}" data-cost-cell>{{ '%.2f'|format(ing.cost) }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            {% endfor %}
                        </table>
                    </div>
                </aside>
            </div>
        </section>

        <button class="btn-primary" type="submit" data-submit-button
                {% if not has_active_constraints %}disabled{% endif %}>{{ ui.button_submit }}</button>
    </form>

    <section class="results-section" data-results style="margin-top: 32px;">
        <div class="card">
            <h2 class="section-title" data-results-title>{{ ui.section_results }}</h2>
            <p class="hint results-placeholder" data-results-placeholder>{{ ui.results_placeholder }}</p>
            <div class="results-loading" data-results-loading hidden role="status" aria-live="polite">
                <div class="loading-spinner" aria-hidden="true"></div>
                <p class="hint">{{ ui.results_loading }}</p>
            </div>
            <p class="hint" data-results-summary hidden></p>
            <p class="hint" data-status-message hidden></p>
            <div class="results-controls" data-results-controls hidden>
                <label class="results-control">
                    <span class="label">{{ ui.results_sort_label }}</span>
                    <select data-sort-attr>
                        {% for a in attrs %}
                            <option value="{{ a }}" {% if loop.first %}selected{% endif %}>{{ attr_labels[a] }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label class="results-control">
                    <span class="label">{{ ui.results_sort_order_label }}</span>
                    <select data-sort-order>
                        <option value="desc" selected>{{ ui.results_sort_desc }}</option>
                        <option value="asc">{{ ui.results_sort_asc }}</option>
                    </select>
                </label>
            </div>
            <p data-results-empty hidden><strong>{{ ui.section_results }}</strong> {{ ui.results_empty }}</p>
        </div>
        <div class="results-list" data-results-list></div>
    </section>

    <section class="card support-section" id="support">
        <h2>{{ ui.support_header }}</h2>
        <p>{{ ui.support }}</p>
        <div class="support-actions">
            <p class="support-note">{{ ui.support_note }}</p>
            <div class="support-buttons">
                <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="honigbartstudios" data-color="#FFDD00" data-emoji="ðŸ»"  data-font="Cookie" data-text="Buy me a beer" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>
            </div>
        </div>
        <h3>Disclaimer</h3>
        <p>{{ ui.disclaimer }}</p>
    </section>
</div>

<footer class="site-footer">
    <div class="footer-inner">
        <div>
            <strong>{{ ui.header_title }}</strong>
            <p class="footer-tagline"></p>
        </div>
        <nav aria-label="Rechtliches">
            <ul class="footer-links">
                <li><a href="{{ url_for('impressum') }}">{{ ui.site_notice }}</a></li>
                <li><a href="{{ url_for('datenschutz') }}">{{ ui.privacy_policy }}</a></li>
                <li><a href="https://github.com/wojoeraf/AleAbbeyBeerCalculator/issues">{{ ui.report_bug }}</a></li>
            </ul>
        </nav>
    </div>
</footer>

<script id="ingredients-data" type="application/json">{{ ingredients_data | tojson }}</script>
<script id="styles-data" type="application/json">{{ styles_data | tojson }}</script>
<script id="meta-data" type="application/json">{{ meta_data | tojson }}</script>
<script id="i18n-data" type="application/json">{{ i18n_payload | tojson }}</script>
<script id="style-min-data" type="application/json">{{ style_min_map | tojson }}</script>
<script type="module" src="{{ url_for('static', filename='solver.js') }}"></script>
</body>
</html>
