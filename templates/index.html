<!doctype html>
<html lang="{{ lang }}">
<head>
    <meta charset="utf-8">
    <title>{{ ui.page_title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
<div class="page">
    <header class="card">
        <div class="header-row">
            <h1>{{ ui.header_title }}</h1>
            <form class="language-switcher" method="get">
                <label for="language-select">{{ ui.language_label }}</label>
                <div class="language-switcher-controls">
                    <select id="language-select" name="lang" onchange="this.form.submit()">
                        {% for entry in languages %}
                            <option value="{{ entry.code }}"
                                    {% if entry.code == lang %}selected{% endif %}>{{ entry.label }}</option>
                        {% endfor %}
                    </select>
                    <noscript>
                        <button type="submit" class="btn-secondary">{{ ui.language_submit }}</button>
                    </noscript>
                </div>
                <input type="hidden" name="style" value="{{ style }}">
            </form>
        </div>
        <p>{{ ui.header_description }}</p>
    </header>

    <form class="card form-card" data-solver-form>
        <input type="hidden" name="lang" value="{{ lang }}">
        <section>
            <h3 class="section-title">{{ ui.section_base }}</h3>
            <div class="grid-two">
                <label>
                    <span class="label">{{ ui.field_style }}</span>
                    <select name="style">
                        {% for s in styles %}
                            <option value="{{ s.id }}" {% if s.id == style %}selected{% endif %}>{{ s.name }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label>
                    <span class="label">{{ ui.field_total_cap }}</span>
                    <input type="number" name="total_cap" min="1" max="30" value="{{ total_cap }}">
                </label>
                <label>
                    <span class="label">{{ ui.field_per_cap }}</span>
                    <input type="number" name="per_cap" min="1" max="30" value="{{ per_cap }}">
                </label>
            </div>
        </section>

        <section>
            <div class="section-header">
                <h3 class="section-title">{{ ui.section_attributes }}</h3>
                <button type="button" class="btn-secondary" data-set-all-green>{{ ui.button_all_green }}</button>
            </div>
            <div class="attr-grid">
                {% for a in attrs %}
                    <div class="attr-card" data-attr-card>
                        <h4>{{ attr_labels[a] }}</h4>
                        <div class="chips">
                            {% for band in ['any', 'green', 'yellow', 'red'] %}
                                {% set label = band_labels.get(band, band) %}
                                <label class="chip" data-color="{{ band }}">
                                    <input type="radio" name="band_{{ a }}" value="{{ band }}"
                                           {% if constraints[a].band == band %}checked{% endif %}>
                                    <span>{{ label }}</span>
                                </label>
                            {% endfor %}
                        </div>

                        <div>
                            <label class="label" style="margin-top:12px;">{{ ui.label_mode }}</label>
                            <select class="mode-select" name="mode_{{ a }}">
                                <option value="any"
                                        {% if constraints[a].mode == 'any' %}selected{% endif %}>{{ mode_labels['any'] }}</option>
                                <option value="ge"
                                        {% if constraints[a].mode == 'ge' %}selected{% endif %}>{{ mode_labels['ge'] }}</option>
                                <option value="le"
                                        {% if constraints[a].mode == 'le' %}selected{% endif %}>{{ mode_labels['le'] }}</option>
                                <option value="between"
                                        {% if constraints[a].mode == 'between' %}selected{% endif %}>{{ mode_labels['between'] }}</option>
                            </select>
                            <div class="range-inputs">
                                <label>{{ ui.label_min }}
                                    <input type="number" class="min-input" name="min_{{ a }}" step="0.1" min="0"
                                           max="11" value="{{ constraints[a].min }}">
                                </label>
                                <label>{{ ui.label_max }}
                                    <input type="number" class="max-input" name="max_{{ a }}" step="0.1" min="0"
                                           max="11" value="{{ constraints[a].max }}">
                                </label>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </section>

        <section>
            <details class="collapsible" data-collapsible open>
                <summary>
                    <h3 class="section-title">{{ ui.section_ingredients }}</h3>
                </summary>
                <div class="table-wrapper">
                    <table class="ingredients-table">
                        <thead>
                        <tr>
                            <th class="col-checkbox"></th>
                            <th>{{ ui.table_name }}</th>
                            <th>{{ ui.table_taste }}</th>
                            <th>{{ ui.table_color }}</th>
                            <th>{{ ui.table_strength }}</th>
                            <th>{{ ui.table_foam }}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for ing in ingredients %}
                            {% set required_count = style_mins.get(ing.id, 0) %}
                            {% set is_required = required_count > 0 %}
                            {% set is_locked = is_required %}
                            {% set is_checked = is_locked or ing.id in selected_optional %}
                            <tr class="{% if is_locked %}ingredient-locked{% endif %}" data-ingredient-row
                                data-ingredient-id="{{ ing.id }}">
                                <td class="checkbox-cell">
                                    <label class="ingredient-option"
                                           {% if is_locked %}title="{{ ui.tooltip_required }}"{% endif %}>
                                        <input type="checkbox" name="optional_ingredients" value="{{ ing.id }}"
                                               {% if is_checked %}checked{% endif %}
                                               {% if is_locked %}disabled{% endif %}
                                               data-user-selected="{{ 'true' if ing.id in selected_optional else 'false' }}">
                                        <span class="checkbox-visual"></span>
                                    </label>
                                </td>
                                <td>
                                    <div class="ingredient-name">
                                        <span>{{ ing.name }}</span>
                                        <span class="ingredient-badge badge-required" data-required-badge
                                              {% if not is_required %}hidden{% endif %}>
                          {% if is_required %}
                              {% if required_count > 1 %}
                                  {{ ui.badge_required_multiple | replace('{count}', '%d' % required_count) }}
                              {% else %}
                                  {{ ui.badge_required_single }}
                              {% endif %}
                          {% else %}
                              {{ ui.badge_required_single }}
                          {% endif %}
                        </span>
                                    </div>
                                </td>
                                <td>{{ '%.1f'|format(ing.vec[0]) }}</td>
                                <td>{{ '%.1f'|format(ing.vec[1]) }}</td>
                                <td>{{ '%.1f'|format(ing.vec[2]) }}</td>
                                <td>{{ '%.1f'|format(ing.vec[3]) }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </details>
        </section>

        <button class="btn-primary" type="submit" data-submit-button
                {% if not has_active_constraints %}disabled{% endif %}>{{ ui.button_submit }}</button>
    </form>

    <section class="results-section" data-results hidden style="margin-top: 32px;">
        <div class="card">
            <h2 class="section-title" data-results-title>{{ ui.section_results }}</h2>
            <p class="hint" data-results-summary></p>
            <p class="hint" data-status-message hidden></p>
            <div class="results-controls" data-results-controls hidden>
                <label class="results-control">
                    <span class="label">{{ ui.results_sort_label }}</span>
                    <select data-sort-attr>
                        {% for a in attrs %}
                            <option value="{{ a }}" {% if loop.first %}selected{% endif %}>{{ attr_labels[a] }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label class="results-control">
                    <span class="label">{{ ui.results_sort_order_label }}</span>
                    <select data-sort-order>
                        <option value="desc" selected>{{ ui.results_sort_desc }}</option>
                        <option value="asc">{{ ui.results_sort_asc }}</option>
                    </select>
                </label>
            </div>
            <p data-results-empty hidden><strong>{{ ui.section_results }}</strong> {{ ui.results_empty }}</p>
        </div>
        <div class="results-list" data-results-list></div>
    </section>

    <section class="card support-section" id="support">
        <h2>Unterstütze Ale Abbey</h2>
        <p>
            Hallo, ich bin der Braumeister hinter Ale Abbey. Diese Seite bleibt bewusst frei von
            Werbung, damit du ohne Ablenkung deine perfekte Bierkreation planen kannst. Wenn dir das
            Projekt gefällt, freue ich mich über deine Unterstützung – damit bleibt Ale Abbey am
            Köcheln!
        </p>
        <div class="support-actions">
            <p class="support-note">Jeder Beitrag hilft – vielen Dank fürs Mitbrauen!</p>
            <div class="support-buttons">
                <a href="https://www.buymeacoffee.com/honigbartstudios" target="_blank"><img
                        src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee"
                        style="height: 60px !important;width: 217px !important;"></a>
            </div>
        </div>
    </section>
</div>

<footer class="site-footer">
    <div class="footer-inner">
        <div>
            <strong>Ale Abbey Beer Calculator</strong>
            <p class="footer-tagline">Braue smarter – ganz ohne Werbung.</p>
        </div>
        <nav aria-label="Rechtliches">
            <ul class="footer-links">
                <li><a href="{{ url_for('impressum') }}">Impressum</a></li>
                <li><a href="{{ url_for('datenschutz') }}">Datenschutz</a></li>
                <li><a href="{{ url_for('kontakt') }}">Kontakt</a></li>
            </ul>
        </nav>
    </div>
</footer>

<script id="ingredients-data" type="application/json">{{ ingredients_data | tojson }}</script>
<script id="styles-data" type="application/json">{{ styles_data | tojson }}</script>
<script id="meta-data" type="application/json">{{ meta_data | tojson }}</script>
<script id="i18n-data" type="application/json">{{ i18n_payload | tojson }}</script>
<script id="style-min-data" type="application/json">{{ style_min_map | tojson }}</script>
<script type="module" src="{{ url_for('static', filename='solver.js') }}"></script>
</body>
</html>
